<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nightreign Map Seed Recognizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles-advanced.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="i18n/translations-advanced.js?v=12"></script>
    <script src="i18n/language-manager.js?v=8"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">
                    <i class="fas fa-map"></i>
                    <span data-i18n="app.title">Nightreign Map Seed Recognizer</span>
                </h1>
                <div class="header-controls">
                    <button id="switch-to-basic-btn" class="control-btn">
                        <i class="fas fa-arrow-left"></i>
                        <span data-i18n="nav.basic">Switch to Basic Mode</span>
                    </button>
                    <button id="lang-toggle" class="lang-btn" title="Switch Language">
                        <i class="fas fa-globe"></i>
                        <span id="current-lang" data-i18n="lang.current">English</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Loading Screen -->
            <div id="loading-screen" class="loading-screen">
                <div class="loading-content">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading map data...</p>
                </div>
            </div>

            <!-- Selection Screen -->
            <div id="selection-screen" class="selection-screen" style="display: none;">
                <div class="selection-container">
                    <h2>Select Parameters</h2>
                    
                    <!-- Map Type Selection -->
                    <div class="selection-group">
                        <h3><span data-i18n="selection.map">Map Type</span> <span class="required">*</span></h3>
                        <div class="map-grid">
                            <button class="map-btn" data-map="Default">
                                <span data-i18n="map.default">Default</span>
                            </button>
                            <button class="map-btn" data-map="Crater">
                                <span data-i18n="map.crater">Crater</span>
                            </button>
                            <button class="map-btn" data-map="Mountaintop">
                                <span data-i18n="map.mountaintop">Mountaintop</span>
                            </button>
                            <button class="map-btn" data-map="Noklateo">
                                <span data-i18n="map.noklateo">Noklateo</span>
                            </button>
                            <button class="map-btn" data-map="Rotted Woods">
                                <span data-i18n="map.rotted_woods">Rotted Woods</span>
                            </button>
                        </div>
                    </div>

                    <!-- Nightlord Selection -->
                    <div class="selection-group">
                        <h3><span data-i18n="selection.nightlord">Nightlord</span> <span class="optional" data-i18n="selection.optional">(Optional)</span></h3>
                        <div class="nightlord-grid">
                            <button class="nightlord-btn" data-nightlord="Adel">
                                <img src="assets/icons/Adel.png" alt="Adel" class="nightlord-icon">
                                <span data-i18n="nightlord.adel">Adel</span>
                            </button>
                            <button class="nightlord-btn" data-nightlord="Caligo">
                                <img src="assets/icons/Caligo.png" alt="Caligo" class="nightlord-icon">
                                <span data-i18n="nightlord.caligo">Caligo</span>
                            </button>
                            <button class="nightlord-btn" data-nightlord="Fulghor">
                                <img src="assets/icons/Fulghor.png" alt="Fulghor" class="nightlord-icon">
                                <span data-i18n="nightlord.fulghor">Fulghor</span>
                            </button>
                            <button class="nightlord-btn" data-nightlord="Gladius">
                                <img src="assets/icons/Gladius.png" alt="Gladius" class="nightlord-icon">
                                <span data-i18n="nightlord.gladius">Gladius</span>
                            </button>
                            <button class="nightlord-btn" data-nightlord="Gnoster">
                                <img src="assets/icons/Gnoster.png" alt="Gnoster" class="nightlord-icon">
                                <span data-i18n="nightlord.gnoster">Gnoster</span>
                            </button>
                            <button class="nightlord-btn" data-nightlord="Heolstor">
                                <img src="assets/icons/Heolstor.png" alt="Heolstor" class="nightlord-icon">
                                <span data-i18n="nightlord.heolstor">Heolstor</span>
                            </button>
                            <button class="nightlord-btn" data-nightlord="Libra">
                                <img src="assets/icons/Libra.png" alt="Libra" class="nightlord-icon">
                                <span data-i18n="nightlord.libra">Libra</span>
                            </button>
                            <button class="nightlord-btn" data-nightlord="Maris">
                                <img src="assets/icons/Maris.png" alt="Maris" class="nightlord-icon">
                                <span data-i18n="nightlord.maris">Maris</span>
                            </button>
                        </div>
                    </div>

                    <button id="start-recognition" class="start-btn" disabled>
                        <i class="fas fa-play"></i>
                        <span data-i18n="actions.start">Select Map Type to Continue</span>
                    </button>
                </div>
            </div>

            <!-- Spawn Point Selection Screen -->
            <div id="spawn-screen" class="spawn-screen" style="display: none;">
                <div class="screen-header">
                    <h2><i class="fas fa-map-marker-alt"></i> <span data-i18n="spawn.title">Select Spawn Point</span></h2>
                    <p data-i18n="spawn.description">Click on a spawn point location to select it, then choose the enemy type.</p>
                </div>

                <div class="current-selection">
                    <span class="selection-label" data-i18n="spawn.map">Map:</span>
                    <span id="spawn-current-map" class="selection-value">-</span>
                    <span class="selection-label" data-i18n="spawn.nightlord">Nightlord:</span>
                    <span id="spawn-current-nightlord" class="selection-value">-</span>
                </div>
                <div class="seed-count">
                    <span class="count-label" data-i18n="spawn.seeds">Matching Seeds:</span>
                    <span id="spawn-seed-count" class="count-value">0</span>
                </div>

                <div class="spawn-controls">
                    <button id="spawn-back-btn" class="control-btn">
                        <i class="fas fa-arrow-left"></i>
                        <span data-i18n="spawn.back">Back</span>
                    </button>
                    <button id="spawn-skip-btn" class="control-btn">
                        <i class="fas fa-forward"></i>
                        <span data-i18n="spawn.skip">Skip Spawn Selection</span>
                    </button>
                    <button id="spawn-help-btn" class="control-btn">
                        <i class="fas fa-question-circle"></i>
                        <span data-i18n="spawn.help">Help</span>
                    </button>
                </div>

                <div class="map-container">
                    <canvas id="spawn-canvas" width="768" height="768"></canvas>
                    
                    <!-- Spawn Context Menu -->
                    <div id="spawn-context-menu" class="context-menu" style="display: none;">
                        <!-- Dynamic content will be generated here -->
                    </div>
                </div>
            </div>

            <!-- Recognition Screen -->
            <div id="recognition-screen" class="recognition-screen" style="display: none;">
                <div class="recognition-header">
                    <div class="current-selection">
                        <span class="selection-label">Map:</span>
                        <span id="current-map" class="selection-value">-</span>
                        <span class="selection-label">Nightlord:</span>
                        <span id="current-nightlord" class="selection-value">-</span>
                    </div>
                    <div class="seed-count">
                        <span class="count-label">Matching Seeds:</span>
                        <span id="seed-count" class="count-value">0</span>
                    </div>
                </div>

                <div class="recognition-controls">
                    <button id="back-btn" class="control-btn">
                        <i class="fas fa-arrow-left"></i>
                        Back
                    </button>
                    <button id="clear-all-btn" class="control-btn clear-btn">
                        <i class="fas fa-eraser"></i>
                        Clear All POIs
                    </button>
                    <button id="help-btn" class="control-btn">
                        <i class="fas fa-question-circle"></i>
                        Help
                    </button>
                </div>

                <div class="map-container">
                    <canvas id="map-canvas" width="768" height="768"></canvas>
                    
                    <!-- Context Menu -->
                    <div id="context-menu" class="context-menu" style="display: none;">
                        <!-- Dynamic content will be generated here -->
                    </div>
                </div>

            </div>

            <!-- Result Screen -->
            <div id="result-screen" class="result-screen" style="display: none;">
                <div class="result-header">
                    <h2><i class="fas fa-check-circle"></i> Seed Found!</h2>
                    <div class="result-info">
                        <div class="result-details">
                            <span class="detail-label">Seed Number:</span>
                            <span id="result-seed-number" class="detail-value">-</span>
                        </div>
                        <div class="result-details">
                            <span class="detail-label">Nightlord:</span>
                            <span id="result-nightlord" class="detail-value">-</span>
                        </div>
                        <div class="result-details">
                            <span class="detail-label">Map Type:</span>
                            <span id="result-map-type" class="detail-value">-</span>
                        </div>
                    </div>
                </div>

                <div class="result-image-container">
                    <img id="result-pattern-image" class="result-pattern-image" alt="Map Pattern" />
                    <div class="result-image-overlay">
                        <button id="open-fullscreen" class="fullscreen-btn">
                            <i class="fas fa-expand"></i>
                            Open in New Tab
                        </button>
                    </div>
                </div>

                <div class="result-controls">
                    <button id="back-to-recognition" class="control-btn">
                        <i class="fas fa-arrow-left"></i>
                        Back to Recognition
                    </button>
                    <button id="new-search" class="control-btn primary">
                        <i class="fas fa-search"></i>
                        New Search
                    </button>
                </div>
            </div>
        </main>

        <!-- Help Modal -->
        <div id="help-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-question-circle"></i> <span data-i18n="help.title">Help</span></h3>
                    <button class="close-btn" id="close-help">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="help-section">
                        <h4 data-i18n="help.overview.title">Overview</h4>
                        <p data-i18n="help.overview.description">This advanced map seed recognizer helps you identify the exact map pattern by marking Points of Interest (POIs) and spawn points. The process involves three main steps: spawn point selection, POI marking, and result identification.</p>
                    </div>

                    <div class="help-section">
                        <h4 data-i18n="help.step1.title">Step 1: Select Nightlord & Map Type</h4>
                        <p data-i18n="help.step1.description">Choose your nightlord character and the map type you're exploring. This initial selection helps narrow down the possible seed patterns.</p>
                    </div>

                    <div class="help-section">
                        <h4 data-i18n="help.step2.title">Step 2: Mark Spawn Point</h4>
                        <p data-i18n="help.step2.description">Click on the spawn point dot on the map, then select the enemy type from the context menu. If you're unsure about the enemy, select "I don't know" to proceed with just the coordinate information.</p>
                        <ul>
                            <li data-i18n="help.step2.tip1">The spawn point helps significantly narrow down possible seeds</li>
                            <li data-i18n="help.step2.tip2">If only one enemy type is possible, it will be auto-selected</li>
                            <li data-i18n="help.step2.tip3">If only one seed remains after spawn selection, you'll go directly to results</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h4 data-i18n="help.step3.title">Step 3: Mark POIs (Points of Interest)</h4>
                        <p data-i18n="help.step3.description">Right-click on POI dots to open context menus and select the correct structure type and enemy. The system will automatically filter seeds based on your selections.</p>
                        <ul>
                            <li data-i18n="help.step3.tip1">Two-layer POIs: Select structure type first, then enemy type</li>
                            <li data-i18n="help.step3.tip2">Single-layer POIs: Select enemy type directly</li>
                            <li data-i18n="help.step3.tip3">If only one option remains in layer 2, it will be auto-selected</li>
                            <li data-i18n="help.step3.tip4">Use "Clear Selection" to reset a POI if you made a mistake</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h4 data-i18n="help.step4.title">Step 4: View Results</h4>
                        <p data-i18n="help.step4.description">Once enough POIs are marked to identify a unique seed, the result screen will show the exact map pattern with seed number, nightlord, and map type details.</p>
                    </div>

                    <div class="help-section">
                        <h4 data-i18n="help.tips.title">Tips & Tricks</h4>
                        <ul>
                            <li data-i18n="help.tips.tip1">Start with spawn point selection for maximum seed filtering</li>
                            <li data-i18n="help.tips.tip2">Mark POIs that are most distinctive or unique to your map</li>
                            <li data-i18n="help.tips.tip3">Use the "Clear All POIs" button to start over if needed</li>
                            <li data-i18n="help.tips.tip4">The "Back" button returns you to the selection screen</li>
                            <li data-i18n="help.tips.tip5">Toggle between English and Chinese using the language button</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h4 data-i18n="help.controls.title">Controls</h4>
                        <ul>
                            <li data-i18n="help.controls.click">Click: Select options from context menus</li>
                            <li data-i18n="help.controls.right_click">Right-click: Open context menu for POIs</li>
                            <li data-i18n="help.controls.clear">Clear All POIs: Reset all POI selections</li>
                            <li data-i18n="help.controls.back">Back: Return to nightlord/map selection</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="poi-data-advanced.js"></script>
    <script src="app-advanced.js"></script>
</body>
</html>
